#!/bin/bash

# Exit the script when a command returns a non true value.
set -e
# Prevent using unset variables.
set -u

if [[ $EUID -eq 0 ]]; then
  echo "$0 cannot be run as root"
  exit 1
fi

OPWD=$(pwd)
cd /tmp

# Remove trash.
sudo rm -rf doxygen-1.8.4*

if which doxygen; then
  echo "Doxygen already installed. No update mechanism in place."
else
  # Install dependencies.
  sudo apt-get update -y >/dev/null 2>&1
  sudo apt-get install -y flex bison

  # Download the Doxygen package.
  wget http://ftp.stack.nl/pub/users/dimitri/doxygen-1.8.4.src.tar.gz

  # Extract the package.
  gunzip doxygen-1.8.4.src.tar.gz
  tar xf doxygen-1.8.4.src.tar
  cd doxygen-1.8.4

  # Configure the package.
  sh ./configure

  # Run the installation.
  make
  sudo make install

  cd /tmp

  # Remove trash.
  sudo rm -rf doxygen-1.8.4*

  # Run the Doxywizard.
  touch ~/Doxyfile

  echo "Your Doxyfile was stored in ~/Doxyfile"
fi

cd $OPWD
